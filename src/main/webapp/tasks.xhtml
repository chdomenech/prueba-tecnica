<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Sistema de Gestión de Tareas</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <h:outputStylesheet library="css" name="styles.css" rendered="false"/>
    <style>
        .task-form {
            margin-bottom: 20px;
        }
        .completed-task {
            text-decoration: line-through;
            color: #999;
        }
        .action-buttons {
            white-space: nowrap;
        }
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .ui-panel {
            background-color: white;
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .ui-panel .ui-panel-titlebar {
            background-color: #007ad9;
            color: white;
            padding: 10px 15px;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
        }
    </style>
</h:head>

    <h:body>
    <h:form id="taskForm">
        <p:panel header="Sistema de Gestión de Tareas">
            
            <p:messages id="messages" showDetail="true" closable="true" 
                       severity="info,error,warn" 
                       style="margin-bottom: 10px;"/>
            
            <p:panel id="taskFormPanel" header="#{taskBean.task.id == null ? 'Nueva Tarea' : 'Editar Tarea'}" 
                    styleClass="task-form">
                <p:panelGrid columns="2" style="width: 100%">
                    <p:outputLabel value="Título:" for="title" required="true"/>
                    <p:inputText id="title" 
                               value="#{taskBean.task.title}" 
                               required="true"
                               requiredMessage="El título es obligatorio"
                               placeholder="Ingrese el título de la tarea"
                               style="width: 100%;"/>
                    
                    <p:outputLabel value="Descripción:" for="description"/>
                    <p:inputTextarea id="description" 
                                   value="#{taskBean.task.description}" 
                                   rows="3"
                                   placeholder="Descripción de la tarea (opcional)"
                                   style="width: 100%;"/>
                    
                    <p:outputLabel value="Fecha Límite:" for="dueDate"/>
                    <p:calendar id="dueDate" 
                              value="#{taskBean.task.dueDate}" 
                              pattern="dd/MM/yyyy"
                              showOn="button"
                              placeholder="Seleccione fecha límite (opcional)"
                              style="width: 100%;"/>
                </p:panelGrid>
                
                <p:message for="title"/>
                
                <p:separator/>
                
                <p:commandButton value="#{taskBean.task.id == null ? 'Crear Tarea' : 'Actualizar Tarea'}" 
                               icon="pi pi-save"
                               action="#{taskBean.guardar()}"
                               update=":taskForm:tasksTable, :taskForm:messages, :taskForm:taskFormPanel"
                               styleClass="ui-button-success"
                               style="margin-right: 10px;"/>
                
                <p:commandButton value="Cancelar" 
                               icon="pi pi-times"
                               action="#{taskBean.nuevaTarea()}"
                               update="taskForm"
                               immediate="true"
                               styleClass="ui-button-secondary"
                               rendered="#{taskBean.task.id != null}"/>
            </p:panel>
            
            <!-- Tabla de tareas -->
            <p:dataTable id="tasksTable" 
                        value="#{taskBean.tasks}" 
                        var="task"
                        paginator="true" 
                        rows="10"
                        emptyMessage="No hay tareas registradas"
                        style="width: 100%">
                
                <p:column headerText="Estado" style="width: 80px;">
                    <h:outputText value="#{task.completed == 1 ? '✓' : '○'}" 
                                style="font-size: 18px; color: #{task.completed == 1 ? '#28a745' : '#ffc107'};"/>
                </p:column>
                
                <p:column headerText="Título" sortBy="#{task.title}">
                    <h:outputText value="#{task.title}" 
                                styleClass="#{task.completed == 1 ? 'completed-task' : ''}"/>
                </p:column>
                
                <p:column headerText="Descripción">
                    <h:outputText value="#{task.description}" 
                                styleClass="#{task.completed == 1 ? 'completed-task' : ''}"/>
                </p:column>
                
                <p:column headerText="Fecha Límite" sortBy="#{task.dueDate}">
                    <h:outputText value="#{task.dueDate}" 
                                styleClass="#{task.completed == 1 ? 'completed-task' : ''}">
                        <f:convertDateTime pattern="dd/MM/yyyy" rendered="#{task.dueDate != null}"/>
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Creada" sortBy="#{task.createdAt}">
                    <h:outputText value="#{task.createdAt}">
                        <f:convertDateTime pattern="dd/MM/yyyy HH:mm" rendered="#{task.createdAt != null}"/>
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Acciones" styleClass="action-buttons" style="width: 200px;">
                    <p:commandButton value="Completar" 
                                   icon="pi pi-check"
                                   action="#{taskBean.marcarCompletada(task.id)}"
                                   update=":taskForm:tasksTable, :taskForm:messages"
                                   process="@this"
                                   immediate="true"
                                   styleClass="ui-button-success"
                                   style="margin-right: 5px; font-size: 11px;"
                                   rendered="#{task.completed == 0}"/>
                    
                    <p:commandButton value="Pendiente" 
                                   icon="pi pi-undo"
                                   action="#{taskBean.marcarPendiente(task.id)}"
                                   update=":taskForm:tasksTable, :taskForm:messages"
                                   process="@this"
                                   immediate="true"
                                   styleClass="ui-button-warning"
                                   style="margin-right: 5px; font-size: 11px;"
                                   rendered="#{task.completed == 1}"/>
                    
                    <p:commandButton value="Eliminar" 
                                   icon="pi pi-trash"
                                   onclick="return confirm('¿Está seguro de eliminar esta tarea?')"
                                   action="#{taskBean.eliminar(task.id)}"
                                   update=":taskForm:tasksTable, :taskForm:messages"
                                   process="@this"
                                   immediate="true"
                                   styleClass="ui-button-danger"
                                   style="font-size: 11px;"/>
                </p:column>
            </p:dataTable>
        </p:panel>
    </h:form>
</h:body>

</html>

